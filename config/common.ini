; Values to be reused in the envs
; https://docs.platformio.org/en/latest/projectconf/interpolation.html
[common]

; https://docs.platformio.org/en/latest/projectconf/section_env_library.html#lib-deps
lib_deps =
    ; todo: Change to the PIO registry–tagged version when a new one is available (>5.13.4).
    ; Temporarily pointing to he head of the 5.x branch, as it contains the fix:
    ; https://github.com/bblanchon/ArduinoJson/issues/1891
    ; todo: upgrade do 6 anyway
    https://github.com/bblanchon/ArduinoJson.git#5.x
    ;bblanchon/ArduinoJson @ ^5.13.4

; https://docs.platformio.org/en/latest/projectconf/sections/env/options/build/build_flags.html
project_global_defines_build_flags =
    '-D APP_NAME="Furnace"'

    '-D SERIAL_BITS_PER_SECOND=115200'

    ; brown GND
    ; red 3v3
    ; orange D2 [pin4 at NodeMcu]
    '-D SERVO_PIN=4'

    '-D WIFI_SSID="${secret.wifi_ssid}"'
    '-D WIFI_PASSWORD="${secret.wifi_password}"'

    '-D WEB_SERVER_PORT=${secret.web_server_port}'
    '-D WEB_SERVER_HOSTNAME="${secret.web_server_hostname}"'

    '-D OTA_UPLOAD_PORT=${secret.ota_upload_port}'
    '-D OTA_UPLOAD_HOSTNAME="${secret.ota_upload_hostname}"'
    !echo '-D OTA_UPLOAD_PASSWORD_MD5=\\"'$(md5 -q -s ${secret.ota_upload_password})'\\"'

    '-D FURNACE_HEATER_BUTTON_PRESSING_ANGLE=0'
    '-D FURNACE_HEATER_BUTTON_NOT_PRESSING_ANGLE=90'
    '-D FURNACE_HEATER_BUTTON_PRESSING_MILLISECONDS=2000'

    ; Latest commit hash; `%h` formats it to the short commit hash version:
    ; https://stackoverflow.com/a/5694454/666907
    ; https://git-scm.com/docs/pretty-formats/2.39.0
    !echo '-D BUILD_GIT_COMMIT_HASH=\\"'$(git log -1 --format=%%h)'\\"'

; https://docs.platformio.org/en/latest/projectconf/sections/env/options/build/build_flags.html
code_quality_build_flags =
    ; The default for Apple Clang is… `c++98` o.O
    ; https://discord.com/channels/583251190591258624/1075788561334415360
    ;
    ; The default for ESP8266 toolchain is `gnu++17`:
    ; https://github.com/esp8266/Arduino/blob/master/platform.txt#L43
    -std=gnu++20

    ; Enables many recommended warnings at once
    ; https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
    -Wall

    ; todo: enable more code quality checkers, just exclude vendor libs somehow…

    ; This enables some extra warning flags that are not enabled by -Wall.
    ; https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
    ; it is OK for my code, shitload of warnings for included libs
;    -Wextra

    ; Warn when a function declaration hides virtual functions from a base clas
    ; https://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Dialect-Options.html
    ; it is OK for my code, shitload of warnings for included libs
;    -Woverloaded-virtual

    ; Warn about deprecated uses of the volatile qualifier. Enabled by default with -std=c++20.
    ; https://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Dialect-Options.html
    ; it is OK for my code, shitload of warnings for included libs
;    -Wvolatile

    ; Warn about overriding virtual functions that are not marked with the override keyword.
    ; https://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Dialect-Options.html
    ; it is OK for my code, shitload of warnings for included libs
;    -Wsuggest-override

    ; Make all warnings into errors.
    ; https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
    ; I cannot turn it on as long as _other_ people keep writing shitty code ;p
;    -Werror

    ; Make the specified warning into an error.
    ; https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
;    -Werror=

    ; Issue all the warnings demanded by strict ISO C and ISO C++
    ; https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
    ; Too much shit from included libs
;    -Wpedantic

    ; Give an error whenever the base standard (see -Wpedantic) requires a diagnostic
    ; https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html
;    -pedantic-errors

    ; Enables an static analysis of program flow
    ; https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html
    ; Too much shit from included libs
;    -fanalyzer
